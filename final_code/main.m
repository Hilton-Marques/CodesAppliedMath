clc;
clear;
close all;
addpath("CellIntersection\","ConvexCell\","Drawer\","GJK\","QuickHull\","ReservoirIntersection\");
%drawer = Drawer(); % drawCells
n = 1000;
model_A = readmatrix("model-182.109.txt");
ids_A = model_A(:,1);
model_A = model_A(1:end,2:end);
%model_B = readmatrix("model-2511.17.txt");
model_B = readmatrix("model-2473.5.txt");
ids_B = model_B(:,1);
model_B = model_B(1:end,2:end);
drawer = Drawer();
%drawer.showModel(model_A,drawer.m_red);
%drawer.showModel(model_B,drawer.m_blue);
%ReservoirIntersection(model_B,model_B,1,ids_B,ids_A);

%view(-99,85);
%drawer.showModel(model_B,drawer.m_blue);


% cell 572 and 53067
pts_572 = [3151.57812 -2008.25000 -3190.63989 ; ...
3100.35938 -1921.25000 -3192.01001 ; ...
3064.98438 -2062.25000 -3172.59009 ; ...
3013.79688 -1975.25000 -3175.23999 ; ...
3151.57812 -2008.25000 -3197.63989 ; ...
3100.35938 -1921.25000 -3199.01001 ; ...
3064.98438 -2062.25000 -3179.59009 ; ...
3013.79688 -1975.25000 -3182.23999 ];

pts_53067 = [3085.82812  -1954.75000  -3179.82007 ; ...
2997.82812  -1904.75000  -3174.13989 ; ...
3037.82812  -2044.75000  -3179.85010 ; ...
2949.82812  -1994.75000  -3173.11011 ; ...
3085.82812  -1954.75000  -3179.82007 ; ...
2997.82812  -1904.75000  -3174.13989 ; ...
3037.82812  -2044.75000  -3181.20996 ; ...
2949.82812  -1994.75000  -3174.10010 ];

%cell 146 and 4132
pts_146 = [3007.82812  -805.250000  -3230.40991 ; ...
2957.48438  -718.750000  -3223.41992 ; ...
2921.26562  -859.250000  -3229.18994 ; ...
2870.92188  -772.750000  -3221.79004 ; ...
3007.82812  -805.250000  -3237.40991 ; ...
2957.48438  -718.750000  -3230.41992 ; ...
2921.26562  -859.250000  -3236.18994 ; ...
2870.92188  -772.750000  -3228.79004 ];

pts_4132 = [2999.82812 -654.750000 -3234.76001 ; ...
2911.82812 -604.750000 -3226.10010 ; ...
2951.82812 -744.750000 -3220.13989 ; ...
2863.82812 -694.750000 -3213.43994 ; ...
2999.82812 -654.750000 -3241.76001 ; ...
2911.82812 -604.750000 -3233.10010 ; ...
2951.82812 -744.750000 -3227.13989 ; ...
2863.82812 -694.750000 -3220.43994 ];

pts_1156 = [[-432.500000 , 2225.00000 , -3158.59009 ]; ...
[-519.500000 , 2275.00000 , -3170.91992 ]; ...
[-480.500000 , 2145.00000 , -3163.04004 ]; ...
[-567.500000 , 2185.00000 , -3178.47998 ]; ...
[-432.500000 , 2225.00000 , -3158.59009 ]; ...
[-519.500000 , 2275.00000 , -3170.91992 ]; ...
[-480.500000 , 2145.00000 , -3166.83008 ]; ...
[-567.500000 , 2185.00000 , -3180.59009 ]];

pts_15382 = [[ -344.500000 2185.00000 -3147.56006] ; ...
[ -432.500000 2225.00000 -3158.59009] ; ...
[ -392.500000 2095.00000 -3152.87012] ; ...
[ -480.500000 2145.00000 -3166.83008] ; ...
[ -344.500000 2185.00000 -3147.56006] ; ...
[ -432.500000 2225.00000 -3158.59009] ; ...
[ -392.500000 2095.00000 -3154.64990] ; ...
[ -480.500000 2145.00000 -3166.83008]];

pts_1 = [[-1948.50000 , 2375.00000 , -3209.43994 ]; ...
[-2036.50000 , 2425.00000 , -3202.65991 ]; ...
[-1996.50000 , 2285.00000 , -3185.59009 ]; ...
[-2084.50000 , 2335.00000 , -3191.12012 ]; ...
[-1948.50000 , 2375.00000 , -3210.25000 ]; ...
[-2036.50000 , 2425.00000 , -3202.65991 ]; ...
[-1996.50000 , 2285.00000 , -3185.59009 ]; ...
[-2084.50000 , 2335.00000 , -3191.12012 ]];

pts_2 = [[-1948.50000 , 2375.00000 , -3202.43994] ; ...
[-2036.50000 , 2425.00000 , -3202.65991] ; ...
[-1996.50000 , 2285.00000 , -3185.59009] ; ...
[-2084.50000 , 2335.00000 , -3189.82007] ; ...
[-1948.50000 , 2375.00000 , -3209.43994] ; ...
[-2036.50000 , 2425.00000 , -3202.65991] ; ...
[-1996.50000 , 2285.00000 , -3185.59009] ; ...
[-2084.50000 , 2335.00000 , -3191.12012]];

pts_4666 = [-500.000000 , -16300.0000 , -6137.10986  ; ...
-400.000000 , -16300.0000 , -6138.54980  ; ...
-500.000000 , -16200.0000 , -6134.25000  ; ...
-400.000000 , -16200.0000 , -6135.04980  ; ...
-500.000000 , -16300.0000 , -6143.91992  ; ...
-400.000000 , -16300.0000 , -6145.31006  ; ...
-500.000000 , -16200.0000 , -6141.04980  ; ...
-400.000000 , -16200.0000 , -6141.79980  ];

pts_4 = [-600.000000 , -16400.0000 , -6138.02002  ; ...
-499.999969 , -16400.0000 , -6139.50000  ; ...
-600.000000 , -16300.0000 , -6136.12988  ; ...
-499.999969 , -16300.0000 , -6137.10986  ; ...
-600.000000 , -16400.0000 , -6144.91992  ; ...
-499.999969 , -16400.0000 , -6146.35010  ; ...
-600.000000 , -16300.0000 , -6142.99023  ; ...
-499.999969 , -16300.0000 , -6143.91992  ];

pts_4665 = [-600.000000  , -16300.0000 , -6136.12988 ; ...
-499.999969  , -16300.0000 , -6137.10986 ; ...
-600.000000  , -16200.0000 , -6133.83984 ; ...
-499.999969  , -16200.0000 , -6134.25000 ; ...
-600.000000  , -16300.0000 , -6142.99023 ; ...
-499.999969  , -16300.0000 , -6143.91992 ; ...
-600.000000  , -16200.0000 , -6140.68994 ; ...
-499.999969  , -16200.0000 , -6141.04980 ];
pts_226 = [2763.48438 -606.750000 -3212.27002 ; ...
2713.14062 -519.750000 -3205.57007 ; ...
2681.92188 -651.750000 -3196.41992 ; ...
2626.57812 -573.750000 -3183.00000 ; ...
2763.48438 -606.750000 -3219.27002 ; ...
2713.14062 -519.750000 -3212.57007 ; ...
2681.92188 -651.750000 -3203.41992 ; ...
2626.57812 -573.750000 -3190.00000 ];

pts_478 = [2775.82812 , -644.750000 , -3199.65991 ; ...
2688.82812 , -594.750000 , -3192.17993 ; ...
2727.82812 , -734.750000 , -3191.29004 ; ...
2640.82812 , -684.750000 , -3180.87988 ; ...
2775.82812 , -644.750000 , -3206.65991 ; ...
2688.82812 , -594.750000 , -3199.17993 ; ...
2727.82812 , -734.750000 , -3198.29004 ; ...
2640.82812 , -684.750000 , -3187.87988 ];

pts_7864 = [2736.82812 -514.750000 -3212.38989 ; ...
2648.82812 -464.750000 -3203.25000 ; ...
2688.82812 -594.750000 -3206.17993 ; ...
2600.82812 -554.750000 -3194.87988 ; ...
2736.82812 -514.750000 -3219.38989 ; ...
2648.82812 -464.750000 -3210.25000 ; ...
2688.82812 -594.750000 -3213.17993 ; ...
2600.82812 -554.750000 -3201.87988 ];

%pts_1 = pts_572;
%pts_2 = pts_53067;
pts_1 = pts_226;
pts_2 = pts_7864;
threshold = 0.1;
[cell_intersection_obj,volume] = CellIntersection(pts_1,pts_2,threshold);
