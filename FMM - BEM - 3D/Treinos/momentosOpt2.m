clear
close all
clc
ng = 7;
n = 6;
a1 = 1;
an = 2*(n)+1;
size = (a1 + an)*(n+1)/2;
M = zeros(size,1);
L = zeros(size,1);
% Momentos
yc = [0.375, 0.875, 0.3750];
xl = [0.6250, 0.375, 0.125];
xs = [2/3, 1/3, 0];
p1 = [1, 1, 0];
p2 = [0, 1, 0];
p3 = [0, 1, 1];
area = findArea(p1,p2,p3);
[X,Y,Wx,Wy] = triQuad(ng);
count = 1;
tic
for n_ = 0:n
    for m_ = -n_:n_
        for l = 1:ng
            for k = 1:ng
                xksi = (1 - X(k,l) - Y(k,l))*p1 + X(k,l)*p2 + Y(k,l)*p3;
                r = xksi - yc;
                M(count) = M(count) + 2*Rnew(r,indexNM(n_,m_),n_)*Wx(k)*Wy(l)*(area/0.5);
            end
        end
        count = count + 1;
    end
end
M;
int = sum(Sb(n+1,xs-yc,[]).*M);
%M2L
r = xl - yc;
SSb = Sb(2*n + 1,r,[]);
count = 1;
for n_ = 0:n
    for m_ = -n_:n_
        for nc = 0: n
            for mc = -nc:nc
                L(count) = L(count) + ...
                    ((-1)^(n_))*SSb(indexNM(n_+nc,m_ + mc))*M(indexNM(nc,mc));
            end
        end
        count = count + 1;
    end
end
L;
%Integral
r = (xs - xl)
RR = R(n+1,r,[]);
int = RR*L
toc
function plotTriangle(p1,p2,p3)
line([p1(1),p2(1)],[p1(2),p2(2)],[p1(3),p2(3)],'Color','black');
line([p2(1),p3(1)],[p2(2),p3(2)],[p2(3),p3(3)],'Color','black');
line([p3(1),p1(1)],[p3(2),p1(2)],[p3(3),p1(3)],'Color','black');
xc = (p1 + p2 + p3)/3;
%text(xc(1),xc(2),num2str(i));
end
function out = R(n,y,m)
if n == 1
    out = 1;
    return;
end
r2 = dot(y,y);
%% Initialize Values
RValues(n) = SphericalHarmonics();
for i = 1:n
    RValues(i) = SphericalHarmonics(i);
end
%% Obtain N,N Values
RValues(1).addNNValue(1);
RValues(1).merge();
for i = 2:n
    Rnn = RValues(i-1).MValuesPos(end);
    value = -Rnn*(y(1) + complex(0,1)*y(2))/(2*(i-1));
    RValues(i).addNNValue(value);
end
%% Obtain N,M Values with M => 0
R10 = y(3)*RValues(1).MValuesPos(1);
RValues(2).addMValues(R10,1);
RValues(2).merge();
for i = 3:n
    obj = RValues(i);
    objAn2 = RValues(i-2);
    objAn1 = RValues(i-1);
    mTot = obj.m;   %Calcule o total de indices m
    mEnd = 1+(mTot-1)/2;  % Calcule quanto tem do centro atÃ© a borda
    for j = 1:mEnd-2
        MValue = (1/(((i-2) + (j-1) + 1)*(i-2 + 1 - (j-1))))*...
            ( (2*(i-2)+1)*y(3)*objAn1.MValuesPos(j) - ...
            r2*objAn2.MValuesPos(j) );
        obj.addMValues(MValue,j);
    end
    j = j + 1;
    MValue = (1/(((i-2) + (j-1) + 1)*(i-2 + 1 - (j-1))))*...
        (2*(i-2)+1)*y(3)*objAn1.MValuesPos(j);
    obj.addMValues(MValue,j);
    obj.merge();  % Find the negative values of m
end
%Quando olhei no mathematica os sinais estavam inversos
out = RValues(end).values;
if ~isempty(m)
    out = out(m);
else
    out = [RValues(:).values];
end
end
function [X,Y,Wx,Wy] = triQuad(N)
v = [0 0; 0 1; 1 0];
n=1:N;  nnk=2*n+1; A=[1/3 repmat(1,1,N)./(nnk.*(nnk+2))];
n=2:N; nnk=nnk(n); B1=2/9; nk=n+1; nnk2=nnk.*nnk;
B=4*(n.*nk).^2./(nnk2.*nnk2-nnk2); ab=[A' [2; B1; B']]; s=sqrt(ab(2:N,2));
[V,X]=eig(diag(ab(1:N,1),0)+diag(s,-1)+diag(s,1));
[X,I]=sort(diag(X)); x=(X+1)/2; wx=ab(1,2)*V(1,I)'.^2/4;
N=N-1; N1=N+1; N2=N+2;  y=cos((2*(N:-1:0)'+1)*pi/(2*N+2));
L=zeros(N1,N2);  y0=2;  iter=0;
while max(abs(y-y0))>eps
    L(:,1)=1;    L(:,2)=y;
    for k=2:N1
        L(:,k+1)=( (2*k-1)*y.*L(:,k)-(k-1)*L(:,k-1) )/k;
    end
    Lp=(N2)*( L(:,N1)-y.*L(:,N2) )./(1-y.^2);
    y0=y;    y=y0-L(:,N2)./Lp;  iter=iter+1;
end
cd=[ 1, 0, 0; -1, 0, 1; 0, 1,-1]*v;
t=(1+y)/2;  Wx=abs(det(cd(2:3,:)))*wx;  Wy=1./((1-y.^2).*Lp.^2)*(N2/N1)^2;
[tt,xx]=meshgrid(t,x); yy=tt.*xx;
X=cd(1,1)+cd(2,1)*xx+cd(3,1)*yy;    Y=cd(1,2)+cd(2,2)*xx+cd(3,2)*yy;
end
function area = findArea(p1,p2,p3)
u = p2 - p1;
v = p3 - p1;
biV = cross(u,v);
n = biV/norm(biV);
area = norm(biV)*0.5;
end
function out = indexNM(n,m)
mtot = 2*(n) + 1;
mvirtual = m + (mtot - 1)/2  + 1;
%Convert the n,m index to a position at a row vector Mnm
a1 = 1;
an = 2*(n-1)+1;
totN = (a1 + an)*(n)/2;
out = totN + mvirtual;
end
function out = Sb(n,y,m)
r = norm(y);
ir2 = 1/dot(y,y);
if n == 1
    out = 1/r;
    return;
end
%% Initialize Values
SValues(n) = SphericalHarmonics();
for i = 1:n
    SValues(i) = SphericalHarmonics(i);
end
%% Obtain N,N Values
SValues(1).addNNValue(1/r);
SValues(1).merge();
for i = 2:n
    Snn = SValues(i-1).MValuesPos(end);
    value = -Snn*(2*(i-2)+1)* (y(1) + complex(0,1)*y(2)) *ir2;
    SValues(i).addNNValue(value);
end
%% Obtain N,M Values
S10 = ir2*y(3)*SValues(1).MValuesPos(1);
SValues(2).addMValues(S10,1);
SValues(2).merge();
for i = 3:n
    obj = SValues(i);
    objAn2 = SValues(i-2);
    objAn1 = SValues(i-1);
    mEnd = 1+(obj.m-1)/2;
    for j = 1:mEnd-2
        MValue = ir2*(-((i-2) + (j-1))*((i-2) - (j-1))*objAn2.MValuesPos(j) + ...
            (2*(i-2) + 1)*y(3)*objAn1.MValuesPos(j) );
        obj.addMValues(MValue,j);
    end
    j = j + 1;
    MValue = ir2*(2*(i-2) + 1)*y(3)*objAn1.MValuesPos(j);
    obj.addMValues(MValue,j);
    obj.merge();
end
out = [SValues(:).values]';
if ~isempty(m)
    level = SValues(end).values';
    out = level(m);
end

end

function out = Rnew(y,pos,n)
y1 = y(1);
y2 = y(2);
y3 = y(3);
if n < 5
    Table = {@(y1,y2,y3)1,@(y1,y2,y3)(1/2).*(y1+(sqrt(-1)*(-1)).*y2),@(y1,y2,y3)y3,@(y1,y2,y3)(1/2).*((-1).*y1+(sqrt(-1)*( ...
        -1)).*y2),@(y1,y2,y3)(1/8).*(y1+(sqrt(-1)*(-1)).*y2).^2,@(y1,y2,y3)(1/2).*(y1+(sqrt(-1)* ...
        (-1)).*y2).*y3,@(y1,y2,y3)(1/4).*((-1).*y1.^2+(-1).*y2.^2+2.*y3.^2),@(y1,y2,y3)(-1/2).*( ...
        y1+sqrt(-1).*y2).*y3,@(y1,y2,y3)(1/8).*(y1+sqrt(-1).*y2).^2,@(y1,y2,y3)(1/48).*(y1+( ...
        sqrt(-1)*(-1)).*y2).^3,@(y1,y2,y3)(1/8).*(y1+(sqrt(-1)*(-1)).*y2).^2.*y3,@(y1,y2,y3)( ...
        -1/16).*(y1+(sqrt(-1)*(-1)).*y2).*(y1.^2+y2.^2+(-4).*y3.^2),@(y1,y2,y3)(1/12) ...
        .*((-3).*y1.^2.*y3+(-3).*y2.^2.*y3+2.*y3.^3),@(y1,y2,y3)(1/16).*(y1+sqrt(-1) ...
        .*y2).*(y1.^2+y2.^2+(-4).*y3.^2),@(y1,y2,y3)(1/8).*(y1+sqrt(-1).*y2).^2.*y3,@(y1,y2,y3)( ...
        -1/48).*(y1+sqrt(-1).*y2).^3,@(y1,y2,y3)(1/384).*(y1+(sqrt(-1)*(-1)).*y2).^4,@(y1,y2,y3) ...
        (1/48).*(y1+(sqrt(-1)*(-1)).*y2).^3.*y3,@(y1,y2,y3)(-1/96).*(y1+(sqrt(-1)*( ...
        -1)).*y2).^2.*(y1.^2+y2.^2+(-6).*y3.^2),@(y1,y2,y3)(-1/48).*(y1+(sqrt(-1)*( ...
        -1)).*y2).*y3.*(3.*y1.^2+3.*y2.^2+(-4).*y3.^2),@(y1,y2,y3)(1/192).*(3.*y1.^4+ ...
        3.*y2.^4+(-24).*y2.^2.*y3.^2+8.*y3.^4+6.*y1.^2.*(y2.^2+(-4).* ...
        y3.^2)),@(y1,y2,y3)(1/48).*(y1+sqrt(-1).*y2).*y3.*(3.*y1.^2+3.*y2.^2+(-4).* ...
        y3.^2),@(y1,y2,y3)(-1/96).*(y1+sqrt(-1).*y2).^2.*(y1.^2+y2.^2+(-6).*y3.^2),@(y1,y2,y3)( ...
        -1/48).*(y1+sqrt(-1).*y2).^3.*y3,@(y1,y2,y3)(1/384).*(y1+sqrt(-1).*y2).^4};
elseif (n >= 5)
    pos = pos - 25;
    Table = {@(y1,y2,y3)(1/3840).*(y1+(sqrt(-1)*(-1)).*y2).^5,@(y1,y2,y3)(1/384).*(y1+(sqrt(-1)*(-1) ...
        ).*y2).^4.*y3,@(y1,y2,y3)(-1/768).*(y1+(sqrt(-1)*(-1)).*y2).^3.*(y1.^2+y2.^2+ ...
        (-8).*y3.^2),@(y1,y2,y3)(-1/96).*(y1+(sqrt(-1)*(-1)).*y2).^2.*y3.*(y1.^2+ ...
        y2.^2+(-2).*y3.^2),@(y1,y2,y3)(1/384).*(y1+(sqrt(-1)*(-1)).*y2).*(y1.^4+ ...
        y2.^4+(-12).*y2.^2.*y3.^2+8.*y3.^4+2.*y1.^2.*(y2.^2+(-6).*y3.^2)),@(y1,y2,y3) ...
        (1/960).*y3.*(15.*y1.^4+15.*y2.^4+(-40).*y2.^2.*y3.^2+8.*y3.^4+ ...
        10.*y1.^2.*(3.*y2.^2+(-4).*y3.^2)),@(y1,y2,y3)(-1/384).*(y1+sqrt(-1).*y2).*( ...
        y1.^4+y2.^4+(-12).*y2.^2.*y3.^2+8.*y3.^4+2.*y1.^2.*(y2.^2+(-6).* ...
        y3.^2)),@(y1,y2,y3)(-1/96).*(y1+sqrt(-1).*y2).^2.*y3.*(y1.^2+y2.^2+(-2).* ...
        y3.^2),@(y1,y2,y3)(1/768).*(y1+sqrt(-1).*y2).^3.*(y1.^2+y2.^2+(-8).*y3.^2),@(y1,y2,y3)( ...
        1/384).*(y1+sqrt(-1).*y2).^4.*y3,@(y1,y2,y3)(-1/3840).*(y1+sqrt(-1).*y2).^5,@(y1,y2,y3)( ...
        1/46080).*(y1+(sqrt(-1)*(-1)).*y2).^6,@(y1,y2,y3)(1/3840).*(y1+(sqrt(-1)*(-1) ...
        ).*y2).^5.*y3,@(y1,y2,y3)(-1/7680).*(y1+(sqrt(-1)*(-1)).*y2).^4.*(y1.^2+ ...
        y2.^2+(-10).*y3.^2),@(y1,y2,y3)(-1/2304).*(y1+(sqrt(-1)*(-1)).*y2).^3.*y3.*( ...
        3.*y1.^2+3.*y2.^2+(-8).*y3.^2),@(y1,y2,y3)(1/3072).*(y1+(sqrt(-1)*(-1)).*y2) ...
        .^2.*(y1.^4+y2.^4+(-16).*y2.^2.*y3.^2+16.*y3.^4+2.*y1.^2.*(y2.^2+( ...
        -8).*y3.^2)),@(y1,y2,y3)(1/1920).*(y1+(sqrt(-1)*(-1)).*y2).*y3.*(5.*y1.^4+5.* ...
        y2.^4+(-20).*y2.^2.*y3.^2+8.*y3.^4+10.*y1.^2.*(y2.^2+(-2).*y3.^2)) ...
        ,@(y1,y2,y3)(1/11520).*((-5).*y1.^6+(-5).*y2.^6+90.*y2.^4.*y3.^2+(-120).* ...
        y2.^2.*y3.^4+16.*y3.^6+(-15).*y1.^4.*(y2.^2+(-6).*y3.^2)+(-15).* ...
        y1.^2.*(y2.^4+(-12).*y2.^2.*y3.^2+8.*y3.^4)),@(y1,y2,y3)(-1/1920).*(y1+sqrt( ...
        -1).*y2).*y3.*(5.*y1.^4+5.*y2.^4+(-20).*y2.^2.*y3.^2+8.*y3.^4+10.* ...
        y1.^2.*(y2.^2+(-2).*y3.^2)),@(y1,y2,y3)(1/3072).*(y1+sqrt(-1).*y2).^2.*( ...
        y1.^4+y2.^4+(-16).*y2.^2.*y3.^2+16.*y3.^4+2.*y1.^2.*(y2.^2+(-8).* ...
        y3.^2)),@(y1,y2,y3)(1/2304).*(y1+sqrt(-1).*y2).^3.*y3.*(3.*y1.^2+3.*y2.^2+( ...
        -8).*y3.^2),@(y1,y2,y3)(-1/7680).*(y1+sqrt(-1).*y2).^4.*(y1.^2+y2.^2+(-10).* ...
        y3.^2),@(y1,y2,y3)(-1/3840).*(y1+sqrt(-1).*y2).^5.*y3,@(y1,y2,y3)(1/46080).*(y1+sqrt(-1) ...
        .*y2).^6,@(y1,y2,y3)(1/645120).*(y1+(sqrt(-1)*(-1)).*y2).^7,@(y1,y2,y3)(1/46080).*(y1+( ...
        sqrt(-1)*(-1)).*y2).^6.*y3,@(y1,y2,y3)(-1/92160).*(y1+(sqrt(-1)*(-1)).*y2) ...
        .^5.*(y1.^2+y2.^2+(-12).*y3.^2),@(y1,y2,y3)(-1/23040).*(y1+(sqrt(-1)*(-1)).* ...
        y2).^4.*y3.*(3.*y1.^2+3.*y2.^2+(-10).*y3.^2),@(y1,y2,y3)(1/92160).*(y1+(sqrt( ...
        -1)*(-1)).*y2).^3.*(3.*y1.^4+3.*y2.^4+(-60).*y2.^2.*y3.^2+80.* ...
        y3.^4+6.*y1.^2.*(y2.^2+(-10).*y3.^2)),@(y1,y2,y3)(1/46080).*(y1+(sqrt(-1)*( ...
        -1)).*y2).^2.*y3.*(15.*y1.^4+15.*y2.^4+(-80).*y2.^2.*y3.^2+48.* ...
        y3.^4+10.*y1.^2.*(3.*y2.^2+(-8).*y3.^2)),@(y1,y2,y3)(-1/92160).*(y1+(sqrt(-1) ...
        *(-1)).*y2).*(5.*y1.^6+5.*y2.^6+(-120).*y2.^4.*y3.^2+240.*y2.^2.* ...
        y3.^4+(-64).*y3.^6+15.*y1.^4.*(y2.^2+(-8).*y3.^2)+15.*y1.^2.*( ...
        y2.^4+(-16).*y2.^2.*y3.^2+16.*y3.^4)),@(y1,y2,y3)(1/80640).*y3.*((-35).* ...
        y1.^6+(-35).*y2.^6+210.*y2.^4.*y3.^2+(-168).*y2.^2.*y3.^4+16.* ...
        y3.^6+(-105).*y1.^4.*(y2.^2+(-2).*y3.^2)+(-21).*y1.^2.*(5.*y2.^4+( ...
        -20).*y2.^2.*y3.^2+8.*y3.^4)),@(y1,y2,y3)(1/92160).*(y1+sqrt(-1).*y2).*(5.* ...
        y1.^6+5.*y2.^6+(-120).*y2.^4.*y3.^2+240.*y2.^2.*y3.^4+(-64).* ...
        y3.^6+15.*y1.^4.*(y2.^2+(-8).*y3.^2)+15.*y1.^2.*(y2.^4+(-16).* ...
        y2.^2.*y3.^2+16.*y3.^4)),@(y1,y2,y3)(1/46080).*(y1+sqrt(-1).*y2).^2.*y3.*( ...
        15.*y1.^4+15.*y2.^4+(-80).*y2.^2.*y3.^2+48.*y3.^4+10.*y1.^2.*(3.* ...
        y2.^2+(-8).*y3.^2)),@(y1,y2,y3)(-1/92160).*(y1+sqrt(-1).*y2).^3.*(3.*y1.^4+ ...
        3.*y2.^4+(-60).*y2.^2.*y3.^2+80.*y3.^4+6.*y1.^2.*(y2.^2+(-10).* ...
        y3.^2)),@(y1,y2,y3)(-1/23040).*(y1+sqrt(-1).*y2).^4.*y3.*(3.*y1.^2+3.*y2.^2+( ...
        -10).*y3.^2),@(y1,y2,y3)(1/92160).*(y1+sqrt(-1).*y2).^5.*(y1.^2+y2.^2+(-12).* ...
        y3.^2),@(y1,y2,y3)(1/46080).*(y1+sqrt(-1).*y2).^6.*y3,@(y1,y2,y3)(-1/645120).*(y1+sqrt( ...
        -1).*y2).^7,@(y1,y2,y3)(1/10321920).*(y1+(sqrt(-1)*(-1)).*y2).^8,@(y1,y2,y3)(1/645120).* ...
        (y1+(sqrt(-1)*(-1)).*y2).^7.*y3,@(y1,y2,y3)(-1/1290240).*(y1+(sqrt(-1)*(-1)) ...
        .*y2).^6.*(y1.^2+y2.^2+(-14).*y3.^2),@(y1,y2,y3)(-1/92160).*(y1+(sqrt(-1)*( ...
        -1)).*y2).^5.*y3.*(y1.^2+y2.^2+(-4).*y3.^2),@(y1,y2,y3)(1/368640).*(y1+(sqrt( ...
        -1)*(-1)).*y2).^4.*(y1.^4+y2.^4+(-24).*y2.^2.*y3.^2+40.*y3.^4+2.* ...
        y1.^2.*(y2.^2+(-12).*y3.^2)),@(y1,y2,y3)(1/92160).*(y1+(sqrt(-1)*(-1)).*y2) ...
        .^3.*y3.*(3.*y1.^4+3.*y2.^4+(-20).*y2.^2.*y3.^2+16.*y3.^4+y1.^2.*( ...
        6.*y2.^2+(-20).*y3.^2)),@(y1,y2,y3)(-1/184320).*(y1+(sqrt(-1)*(-1)).*y2).^2.* ...
        (y1.^6+y2.^6+(-30).*y2.^4.*y3.^2+80.*y2.^2.*y3.^4+(-32).*y3.^6+3.* ...
        y1.^4.*(y2.^2+(-10).*y3.^2)+y1.^2.*(3.*y2.^4+(-60).*y2.^2.*y3.^2+ ...
        80.*y3.^4)),@(y1,y2,y3)(-1/645120).*(y1+(sqrt(-1)*(-1)).*y2).*y3.*(35.*y1.^6+ ...
        35.*y2.^6+(-280).*y2.^4.*y3.^2+336.*y2.^2.*y3.^4+(-64).*y3.^6+35.* ...
        y1.^4.*(3.*y2.^2+(-8).*y3.^2)+7.*y1.^2.*(15.*y2.^4+(-80).*y2.^2.* ...
        y3.^2+48.*y3.^4)),@(y1,y2,y3)(1/5160960).*(35.*y1.^8+35.*y2.^8+(-1120).* ...
        y2.^6.*y3.^2+3360.*y2.^4.*y3.^4+(-1792).*y2.^2.*y3.^6+128.*y3.^8+ ...
        140.*y1.^6.*(y2.^2+(-8).*y3.^2)+210.*y1.^4.*(y2.^4+(-16).*y2.^2.* ...
        y3.^2+16.*y3.^4)+28.*y1.^2.*(5.*y2.^6+(-120).*y2.^4.*y3.^2+240.* ...
        y2.^2.*y3.^4+(-64).*y3.^6)),@(y1,y2,y3)(1/645120).*(y1+sqrt(-1).*y2).*y3.*( ...
        35.*y1.^6+35.*y2.^6+(-280).*y2.^4.*y3.^2+336.*y2.^2.*y3.^4+(-64).* ...
        y3.^6+35.*y1.^4.*(3.*y2.^2+(-8).*y3.^2)+7.*y1.^2.*(15.*y2.^4+(-80) ...
        .*y2.^2.*y3.^2+48.*y3.^4)),@(y1,y2,y3)(-1/184320).*(y1+sqrt(-1).*y2).^2.*( ...
        y1.^6+y2.^6+(-30).*y2.^4.*y3.^2+80.*y2.^2.*y3.^4+(-32).*y3.^6+3.* ...
        y1.^4.*(y2.^2+(-10).*y3.^2)+y1.^2.*(3.*y2.^4+(-60).*y2.^2.*y3.^2+ ...
        80.*y3.^4)),@(y1,y2,y3)(-1/92160).*(y1+sqrt(-1).*y2).^3.*y3.*(3.*y1.^4+3.* ...
        y2.^4+(-20).*y2.^2.*y3.^2+16.*y3.^4+y1.^2.*(6.*y2.^2+(-20).*y3.^2) ...
        ),@(y1,y2,y3)(1/368640).*(y1+sqrt(-1).*y2).^4.*(y1.^4+y2.^4+(-24).*y2.^2.* ...
        y3.^2+40.*y3.^4+2.*y1.^2.*(y2.^2+(-12).*y3.^2)),@(y1,y2,y3)(1/92160).*(y1+ ...
        sqrt(-1).*y2).^5.*y3.*(y1.^2+y2.^2+(-4).*y3.^2),@(y1,y2,y3)(-1/1290240).*(y1+ ...
        sqrt(-1).*y2).^6.*(y1.^2+y2.^2+(-14).*y3.^2),@(y1,y2,y3)(-1/645120).*(y1+ ...
        sqrt(-1).*y2).^7.*y3,@(y1,y2,y3)(1/10321920).*(y1+sqrt(-1).*y2).^8,@(y1,y2,y3)( ...
        1/185794560).*(y1+(sqrt(-1)*(-1)).*y2).^9,@(y1,y2,y3)(1/10321920).*(y1+(sqrt( ...
        -1)*(-1)).*y2).^8.*y3,@(y1,y2,y3)(-1/20643840).*(y1+(sqrt(-1)*(-1)).*y2).^7.* ...
        (y1.^2+y2.^2+(-16).*y3.^2),@(y1,y2,y3)(-1/3870720).*(y1+(sqrt(-1)*(-1)).*y2) ...
        .^6.*y3.*(3.*y1.^2+3.*y2.^2+(-14).*y3.^2),@(y1,y2,y3)(1/5160960).*(y1+(sqrt( ...
        -1)*(-1)).*y2).^5.*(y1.^4+y2.^4+(-28).*y2.^2.*y3.^2+56.*y3.^4+2.* ...
        y1.^2.*(y2.^2+(-14).*y3.^2)),@(y1,y2,y3)(1/368640).*(y1+(sqrt(-1)*(-1)).*y2) ...
        .^4.*y3.*(y1.^4+y2.^4+(-8).*y2.^2.*y3.^2+8.*y3.^4+2.*y1.^2.*( ...
        y2.^2+(-4).*y3.^2)),@(y1,y2,y3)(-1/2211840).*(y1+(sqrt(-1)*(-1)).*y2).^3.*( ...
        y1.^6+y2.^6+(-36).*y2.^4.*y3.^2+120.*y2.^2.*y3.^4+(-64).*y3.^6+3.* ...
        y1.^4.*(y2.^2+(-12).*y3.^2)+3.*y1.^2.*(y2.^4+(-24).*y2.^2.*y3.^2+ ...
        40.*y3.^4)),@(y1,y2,y3)(-1/1290240).*(y1+(sqrt(-1)*(-1)).*y2).^2.*y3.*(7.* ...
        y1.^6+7.*y2.^6+(-70).*y2.^4.*y3.^2+112.*y2.^2.*y3.^4+(-32).*y3.^6+ ...
        7.*y1.^4.*(3.*y2.^2+(-10).*y3.^2)+7.*y1.^2.*(3.*y2.^4+(-20).* ...
        y2.^2.*y3.^2+16.*y3.^4)),@(y1,y2,y3)(1/10321920).*(y1+(sqrt(-1)*(-1)).*y2).*( ...
        7.*y1.^8+7.*y2.^8+(-280).*y2.^6.*y3.^2+1120.*y2.^4.*y3.^4+(-896).* ...
        y2.^2.*y3.^6+128.*y3.^8+28.*y1.^6.*(y2.^2+(-10).*y3.^2)+14.* ...
        y1.^4.*(3.*y2.^4+(-60).*y2.^2.*y3.^2+80.*y3.^4)+28.*y1.^2.*(y2.^6+ ...
        (-30).*y2.^4.*y3.^2+80.*y2.^2.*y3.^4+(-32).*y3.^6)),@(y1,y2,y3)(1/46448640).* ...
        y3.*(315.*y1.^8+315.*y2.^8+(-3360).*y2.^6.*y3.^2+6048.*y2.^4.* ...
        y3.^4+(-2304).*y2.^2.*y3.^6+128.*y3.^8+420.*y1.^6.*(3.*y2.^2+(-8) ...
        .*y3.^2)+126.*y1.^4.*(15.*y2.^4+(-80).*y2.^2.*y3.^2+48.*y3.^4)+ ...
        36.*y1.^2.*(35.*y2.^6+(-280).*y2.^4.*y3.^2+336.*y2.^2.*y3.^4+(-64) ...
        .*y3.^6)),@(y1,y2,y3)(-1/10321920).*(y1+sqrt(-1).*y2).*(7.*y1.^8+7.*y2.^8+( ...
        -280).*y2.^6.*y3.^2+1120.*y2.^4.*y3.^4+(-896).*y2.^2.*y3.^6+128.* ...
        y3.^8+28.*y1.^6.*(y2.^2+(-10).*y3.^2)+14.*y1.^4.*(3.*y2.^4+(-60).* ...
        y2.^2.*y3.^2+80.*y3.^4)+28.*y1.^2.*(y2.^6+(-30).*y2.^4.*y3.^2+80.* ...
        y2.^2.*y3.^4+(-32).*y3.^6)),@(y1,y2,y3)(-1/1290240).*(y1+sqrt(-1).*y2).^2.* ...
        y3.*(7.*y1.^6+7.*y2.^6+(-70).*y2.^4.*y3.^2+112.*y2.^2.*y3.^4+(-32) ...
        .*y3.^6+7.*y1.^4.*(3.*y2.^2+(-10).*y3.^2)+7.*y1.^2.*(3.*y2.^4+( ...
        -20).*y2.^2.*y3.^2+16.*y3.^4)),@(y1,y2,y3)(1/2211840).*(y1+sqrt(-1).*y2).^3.* ...
        (y1.^6+y2.^6+(-36).*y2.^4.*y3.^2+120.*y2.^2.*y3.^4+(-64).*y3.^6+ ...
        3.*y1.^4.*(y2.^2+(-12).*y3.^2)+3.*y1.^2.*(y2.^4+(-24).*y2.^2.* ...
        y3.^2+40.*y3.^4)),@(y1,y2,y3)(1/368640).*(y1+sqrt(-1).*y2).^4.*y3.*(y1.^4+ ...
        y2.^4+(-8).*y2.^2.*y3.^2+8.*y3.^4+2.*y1.^2.*(y2.^2+(-4).*y3.^2)),@(y1,y2,y3)( ...
        -1/5160960).*(y1+sqrt(-1).*y2).^5.*(y1.^4+y2.^4+(-28).*y2.^2.* ...
        y3.^2+56.*y3.^4+2.*y1.^2.*(y2.^2+(-14).*y3.^2)),@(y1,y2,y3)(-1/3870720).*(y1+ ...
        sqrt(-1).*y2).^6.*y3.*(3.*y1.^2+3.*y2.^2+(-14).*y3.^2),@(y1,y2,y3)( ...
        1/20643840).*(y1+sqrt(-1).*y2).^7.*(y1.^2+y2.^2+(-16).*y3.^2),@(y1,y2,y3)( ...
        1/10321920).*(y1+sqrt(-1).*y2).^8.*y3,@(y1,y2,y3)(-1/185794560).*(y1+sqrt(-1) ...
        .*y2).^9,@(y1,y2,y3)(1/3715891200).*(y1+(sqrt(-1)*(-1)).*y2).^10,@(y1,y2,y3)( ...
        1/185794560).*(y1+(sqrt(-1)*(-1)).*y2).^9.*y3,@(y1,y2,y3)(-1/371589120).*(y1+ ...
        (sqrt(-1)*(-1)).*y2).^8.*(y1.^2+y2.^2+(-18).*y3.^2),@(y1,y2,y3)(-1/61931520) ...
        .*(y1+(sqrt(-1)*(-1)).*y2).^7.*y3.*(3.*y1.^2+3.*y2.^2+(-16).* ...
        y3.^2),@(y1,y2,y3)(1/247726080).*(y1+(sqrt(-1)*(-1)).*y2).^6.*(3.*y1.^4+3.* ...
        y2.^4+(-96).*y2.^2.*y3.^2+224.*y3.^4+6.*y1.^2.*(y2.^2+(-16).* ...
        y3.^2)),@(y1,y2,y3)(1/77414400).*(y1+(sqrt(-1)*(-1)).*y2).^5.*y3.*(15.*y1.^4+ ...
        15.*y2.^4+(-140).*y2.^2.*y3.^2+168.*y3.^4+10.*y1.^2.*(3.*y2.^2+( ...
        -14).*y3.^2)),@(y1,y2,y3)(-1/30965760).*(y1+(sqrt(-1)*(-1)).*y2).^4.*(y1.^6+ ...
        y2.^6+(-42).*y2.^4.*y3.^2+168.*y2.^2.*y3.^4+(-112).*y3.^6+3.* ...
        y1.^4.*(y2.^2+(-14).*y3.^2)+3.*y1.^2.*(y2.^4+(-28).*y2.^2.*y3.^2+ ...
        56.*y3.^4)),@(y1,y2,y3)(-1/15482880).*(y1+(sqrt(-1)*(-1)).*y2).^3.*y3.*(7.* ...
        y1.^6+7.*y2.^6+(-84).*y2.^4.*y3.^2+168.*y2.^2.*y3.^4+(-64).*y3.^6+ ...
        21.*y1.^4.*(y2.^2+(-4).*y3.^2)+21.*y1.^2.*(y2.^4+(-8).*y2.^2.* ...
        y3.^2+8.*y3.^4)),@(y1,y2,y3)(1/123863040).*(y1+(sqrt(-1)*(-1)).*y2).^2.*(7.* ...
        y1.^8+7.*y2.^8+(-336).*y2.^6.*y3.^2+1680.*y2.^4.*y3.^4+(-1792).* ...
        y2.^2.*y3.^6+384.*y3.^8+28.*y1.^6.*(y2.^2+(-12).*y3.^2)+42.* ...
        y1.^4.*(y2.^4+(-24).*y2.^2.*y3.^2+40.*y3.^4)+28.*y1.^2.*(y2.^6+( ...
        -36).*y2.^4.*y3.^2+120.*y2.^2.*y3.^4+(-64).*y3.^6)),@(y1,y2,y3)(1/92897280).* ...
        (y1+(sqrt(-1)*(-1)).*y2).*y3.*(63.*y1.^8+63.*y2.^8+(-840).*y2.^6.* ...
        y3.^2+2016.*y2.^4.*y3.^4+(-1152).*y2.^2.*y3.^6+128.*y3.^8+84.* ...
        y1.^6.*(3.*y2.^2+(-10).*y3.^2)+126.*y1.^4.*(3.*y2.^4+(-20).* ...
        y2.^2.*y3.^2+16.*y3.^4)+36.*y1.^2.*(7.*y2.^6+(-70).*y2.^4.*y3.^2+ ...
        112.*y2.^2.*y3.^4+(-32).*y3.^6)),@(y1,y2,y3)(1/928972800).*((-63).*y1.^10+( ...
        -63).*y2.^10+3150.*y2.^8.*y3.^2+(-16800).*y2.^6.*y3.^4+20160.* ...
        y2.^4.*y3.^6+(-5760).*y2.^2.*y3.^8+256.*y3.^10+(-315).*y1.^8.*( ...
        y2.^2+(-10).*y3.^2)+(-210).*y1.^6.*(3.*y2.^4+(-60).*y2.^2.*y3.^2+ ...
        80.*y3.^4)+(-630).*y1.^4.*(y2.^6+(-30).*y2.^4.*y3.^2+80.*y2.^2.* ...
        y3.^4+(-32).*y3.^6)+(-45).*y1.^2.*(7.*y2.^8+(-280).*y2.^6.*y3.^2+ ...
        1120.*y2.^4.*y3.^4+(-896).*y2.^2.*y3.^6+128.*y3.^8)),@(y1,y2,y3)(-1/92897280) ...
        .*(y1+sqrt(-1).*y2).*y3.*(63.*y1.^8+63.*y2.^8+(-840).*y2.^6.* ...
        y3.^2+2016.*y2.^4.*y3.^4+(-1152).*y2.^2.*y3.^6+128.*y3.^8+84.* ...
        y1.^6.*(3.*y2.^2+(-10).*y3.^2)+126.*y1.^4.*(3.*y2.^4+(-20).* ...
        y2.^2.*y3.^2+16.*y3.^4)+36.*y1.^2.*(7.*y2.^6+(-70).*y2.^4.*y3.^2+ ...
        112.*y2.^2.*y3.^4+(-32).*y3.^6)),@(y1,y2,y3)(1/123863040).*(y1+sqrt(-1).*y2) ...
        .^2.*(7.*y1.^8+7.*y2.^8+(-336).*y2.^6.*y3.^2+1680.*y2.^4.*y3.^4+( ...
        -1792).*y2.^2.*y3.^6+384.*y3.^8+28.*y1.^6.*(y2.^2+(-12).*y3.^2)+ ...
        42.*y1.^4.*(y2.^4+(-24).*y2.^2.*y3.^2+40.*y3.^4)+28.*y1.^2.*( ...
        y2.^6+(-36).*y2.^4.*y3.^2+120.*y2.^2.*y3.^4+(-64).*y3.^6)),@(y1,y2,y3)( ...
        1/15482880).*(y1+sqrt(-1).*y2).^3.*y3.*(7.*y1.^6+7.*y2.^6+(-84).* ...
        y2.^4.*y3.^2+168.*y2.^2.*y3.^4+(-64).*y3.^6+21.*y1.^4.*(y2.^2+(-4) ...
        .*y3.^2)+21.*y1.^2.*(y2.^4+(-8).*y2.^2.*y3.^2+8.*y3.^4)),@(y1,y2,y3)( ...
        -1/30965760).*(y1+sqrt(-1).*y2).^4.*(y1.^6+y2.^6+(-42).*y2.^4.* ...
        y3.^2+168.*y2.^2.*y3.^4+(-112).*y3.^6+3.*y1.^4.*(y2.^2+(-14).* ...
        y3.^2)+3.*y1.^2.*(y2.^4+(-28).*y2.^2.*y3.^2+56.*y3.^4)),@(y1,y2,y3)( ...
        -1/77414400).*(y1+sqrt(-1).*y2).^5.*y3.*(15.*y1.^4+15.*y2.^4+( ...
        -140).*y2.^2.*y3.^2+168.*y3.^4+10.*y1.^2.*(3.*y2.^2+(-14).*y3.^2)) ...
        ,@(y1,y2,y3)(1/247726080).*(y1+sqrt(-1).*y2).^6.*(3.*y1.^4+3.*y2.^4+(-96).* ...
        y2.^2.*y3.^2+224.*y3.^4+6.*y1.^2.*(y2.^2+(-16).*y3.^2)),@(y1,y2,y3)( ...
        1/61931520).*(y1+sqrt(-1).*y2).^7.*y3.*(3.*y1.^2+3.*y2.^2+(-16).* ...
        y3.^2),@(y1,y2,y3)(-1/371589120).*(y1+sqrt(-1).*y2).^8.*(y1.^2+y2.^2+(-18).* ...
        y3.^2),@(y1,y2,y3)(-1/185794560).*(y1+sqrt(-1).*y2).^9.*y3,@(y1,y2,y3)(1/3715891200).*( ...
        y1+sqrt(-1).*y2).^10};
end
out = Table{pos}(y1,y2,y3);
end
